{"version":3,"file":"vue.js","sources":["../src/util.js","../src/observer/array.js","../src/observer/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["export function isFunction (val) {\r\n  return typeof val === 'function'\r\n}\r\n\r\nexport function isObject(val) {\r\n  return typeof val === 'object' && val !== null\r\n}","let oldArrayPrototype = Array.prototype\r\n// 继承数组方法\r\nexport let arrayMethods = Object.create(oldArrayPrototype)\r\n// arrayMethods.__proto__ = Array.prototype \r\n\r\n//只有这7个可以改变原数组\r\nlet methods = [\r\n  'push',\r\n  'shift',\r\n  'unshift',\r\n  'pop',\r\n  'reverse',\r\n  'sort',\r\n  'splice'\r\n]\r\n\r\nmethods.forEach(method => {\r\n  // 用户调用的如果是以上七个方法,会用重写的,负责调用原来的数组方法\r\n  arrayMethods[method] = function (...args) {\r\n    // 此处this是数组\r\n    oldArrayPrototypep[method].call(this, ...args)\r\n    let inserted\r\n    let ob = this.__ob__//根据当前数组获取observe实例\r\n    switch(method){\r\n      case 'push':\r\n      case 'unshift':\r\n        inserted = args // 就是新增的内容\r\n        break\r\n      case 'splice':\r\n        inserted = args.slice(2)\r\n        break\r\n      default: \r\n        break\r\n    }\r\n    // 如果有新增的内容要继续劫持 需要观测数组每一项,而不是数组\r\n    if(inserted) ob.observeArray(inserted)\r\n\r\n    // arr.push({a:1}, {b:2})\r\n    // arr.splice(0, 1, xxxx)\r\n  }\r\n})","import { isObject } from \"../util\";\r\nimport { arrayMethods } from \"./array\";\r\n\r\n// 1.如果数据是对象 会将对象不停的递归 进行劫持\r\n// 2.如果是数组, 会劫持数组的方法 并对数组中不是基本数据类型的进行检测\r\n\r\n//检测数据变化，类有类型,对象无类型\r\nclass Observer{\r\n  constructor(data) {//对对象中的所有属性进行劫持\r\n    Object.defineProperty(data, '__ob__', {\r\n      value: this,\r\n      enumerable: false //不可枚举\r\n    })\r\n    // data.__ob__ = this //所有被劫持过的属性都有__ob__\r\n    if(Array.isArray(data)) {\r\n      //数组劫持，对数组原来方法改写,切片编程\r\n      data.__proto__  = arrayMethods\r\n      //如果数组中的数据是对象类型,需要监控对象的变化\r\n      this.observeArray(data)\r\n    }else {\r\n      this.walk(data) //对象劫持\r\n    }\r\n  }\r\n\r\n  observeArray(data) { //对数组中的数组和数组中的对象再次劫持\r\n    data.forEach(item => {\r\n      observe(item)\r\n    })\r\n  }\r\n\r\n  walk(data) {//传入的对象\r\n    Object.keys(data).forEach(key => {\r\n      defineReactive(data, key, data[key])\r\n    })\r\n  }\r\n}\r\n\r\n//vue2会对对象进行遍历,将每个属性用defineProperty重新定义,所以导致性能差\r\nfunction defineReactive(data, key, value){//value有可能是对象\r\n  observe (value)//本身用户默认值是对象套对象,需要递归处理（性能差）\r\n  Object.defineProperty(data, key,{\r\n    get() {\r\n      return value\r\n    },\r\n    set(newV) {\r\n      observe (newV)// 如果用户赋值一个新对象,需要将这个对象进行劫持\r\n      value = newV\r\n    }\r\n  })\r\n}\r\n\r\nexport function observe (data) {\r\n  //如果是对象类型才观测\r\n  if(!isObject(data)) {\r\n    return\r\n  }\r\n  //判断data有没有被观测\r\n  if(data.__ob__) {\r\n    return\r\n  }\r\n  return new Observer(data)\r\n}","import { observe } from \"./observer/index\"\r\nimport { isFunction } from \"./util\"\r\n\r\n// 状态初始化\r\nexport function initState(vm) {\r\n  const opts = vm.$options\r\n  // if (opts.props) {\r\n  //   initProps()\r\n  // }\r\n  if (opts.data) {\r\n    initData(vm)\r\n  }\r\n  // if (opts.computed) {\r\n  //   initComputed()\r\n  // }\r\n  // if (opts.watch) {\r\n  //   initWatch()\r\n  // }\r\n}\r\n\r\n// 代理\r\nfunction proxy(vm, source, key) {\r\n  Object.defineProperty(vm, key, {\r\n    get() {\r\n      return vm[source][key]\r\n    },\r\n    set(newVal) {\r\n      vm[source][key] = newVal\r\n    }\r\n  })\r\n}\r\n\r\nfunction initData(vm) {\r\n  let data = vm.$options.data // vm.$el vue内部会对属性检测如果以$开头 不会进行代理\r\n  // vue2会将data中的所有数据进行劫持 Object.defineProperty\r\n  //这个时候data和vm没有任何关系,通过_data进行关联\r\n  data = vm._data =isFunction(data)?data.call(vm): data\r\n\r\n  for(let key in data) { //取name时直接可以写vm.name vm.xxx => vm._data.xxx\r\n    proxy(vm, '_data', key)\r\n  }\r\n  \r\n  observe(data)\r\n}","import { initState } from \"./state\"\r\n\r\nexport function initMixin(Vue) { //表示在vue的基础上做一次混合操作\r\n  Vue.prototype._init = function (options) {\r\n    const vm = this\r\n    vm.$options = options//后面会对options进行扩展\r\n\r\n    // 对数据进行初始化\r\n    initState(vm)//vm.$options.data\r\n  }\r\n}\r\n\r\n","//用class类写vue不好拆封,所以采用构造函数方式写\r\n\r\nimport { initMixin } from './init'\r\n\r\nfunction Vue(options) {\r\n  // options用户传入选项\r\n  //构造函数中的this指向new的实例\r\n  this._init(options)// 初始化操作\r\n}\r\n// 扩展原型\r\ninitMixin(Vue)\r\n\r\nexport default Vue"],"names":["isFunction","val","isObject","oldArrayPrototype","Array","prototype","arrayMethods","Object","create","methods","forEach","method","args","oldArrayPrototypep","call","inserted","ob","__ob__","slice","observeArray","Observer","data","defineProperty","value","enumerable","isArray","__proto__","walk","item","observe","keys","key","defineReactive","get","set","newV","initState","vm","opts","$options","initData","proxy","source","newVal","_data","initMixin","Vue","_init","options"],"mappings":"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"}