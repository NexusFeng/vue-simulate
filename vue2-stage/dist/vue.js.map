{"version":3,"file":"vue.js","sources":["../src/util.js","../src/global-api/index.js","../src/compiler/generate.js","../src/compiler/parser.js","../src/compiler/index.js","../src/observer/dep.js","../src/observer/scheduler.js","../src/observer/watcher.js","../src/vdom/patch.js","../src/lifecycle.js","../src/observer/array.js","../src/observer/index.js","../src/state.js","../src/init.js","../src/vdom/index.js","../src/render.js","../src/index.js"],"sourcesContent":["export function isFunction (val) {\r\n  return typeof val === 'function'\r\n}\r\n\r\nexport function isObject(val) {\r\n  return typeof val === 'object' && val !== null\r\n}\r\n\r\nconst callbacks = []\r\nfunction flushCallbacks() {\r\n  callbacks.forEach(cb => cb())\r\n  waiting = false\r\n}\r\n\r\nlet waiting = false\r\nfunction timer(flushCallbacks) {\r\n  let timerFn = () => {}\r\n\r\n  if(Promise) {\r\n    timerFn = () => {\r\n      Promise.resolve().then(flushCallbacks)\r\n    }\r\n  } else if(MutationObserver){\r\n    let textNode = document.createTextNode(1)\r\n    let observe = new MutationObserver(flushCallbacks)\r\n    observe.observe(textNode, {\r\n      characterData: true\r\n    })\r\n\r\n    timerFn = () => {\r\n      textNode.textContent = 3\r\n    }\r\n\r\n    // 微任务\r\n  } else if (setImmedidate) {\r\n    timerFn = () => {\r\n      setImmedidate(flushCallbacks)\r\n    }\r\n  } else {\r\n    timerFn = () => {\r\n      setTimeout(flushCallbacks)\r\n    }\r\n  }\r\n  timerFn()\r\n  \r\n\r\n}\r\n\r\n\r\n// 微任务是在页面渲染前执行,取得是内存中的dom，不关心是否渲染完\r\nexport function nextTick(cb) {\r\n  callbacks.push(cb) // flushSchedulerQueue先执行，用户的$nextTick后执行\r\n\r\n  if (!waiting) {\r\n    // Promise.resolve().then(flushCallbacks)//vue2考虑兼容性问题， vue3不考虑\r\n    // 处理兼容性\r\n    timer(flushCallbacks)\r\n    waiting = true\r\n  }\r\n}\r\n\r\nlet lifecycleHooks = [\r\n  'beforeCreate',\r\n  'created',\r\n  'beforeMount',\r\n  'mounted',\r\n  'beforeUpdate',\r\n  'updated',\r\n  'beforeDestroy',\r\n  'destroyed'\r\n]\r\n\r\n// 第一次调用                     {}         {beforeCreate: Fn} => {beforeCreate: [fn]}\r\n// 第二次调用        {beforeCreate: [fn]} {beforeCreate: Fn2} => {beforeCreate: [fn,fn2]}\r\nfunction mergeHook(parentVal, childVal) {\r\n  if(childVal) {\r\n    if(parentVal) {\r\n      return parentVal.concat(childVal)\r\n    }else {\r\n      return [childVal]\r\n    }\r\n  }else {\r\n    return parentVal\r\n  }\r\n}\r\n\r\nlet strats = {}//存放各种策略\r\nlifecycleHooks.forEach(hook => {\r\n  strats[hook] = mergeHook\r\n})\r\n\r\n// strats.data = function () {\r\n\r\n// }\r\n\r\nstrats.components = function (parentVal, childVal) {\r\n  let options = Object.create(parentVal) //根据父对象构造一个新对象 options.__proto__\r\n  if(childVal) {\r\n    for(let key in childVal) {\r\n      options[key] = childVal[key]\r\n    }\r\n  }\r\n  return options\r\n}\r\n\r\n\r\n\r\n\r\nexport function mergeOptions(parent, child) {\r\n  const options = {} //合并后的结果\r\n  for(let key in parent) {\r\n    mergeField(key)\r\n  }\r\n  for(let key in child) {\r\n    if(parent.hasOwnProperty(key)) {\r\n      continue\r\n    }\r\n    mergeField(key)\r\n  }\r\n\r\n  function mergeField(key) {\r\n    let parentVal = parent[key]\r\n    let childVal = child[key]\r\n    // 策略模式\r\n    if (strats[key]) {//如果有对应的策略就调用对应的策略即可\r\n      options[key] = strats[key](parentVal, childVal)\r\n    }else {\r\n      if(isObject(parentVal) && isObject(childVal)) {\r\n        options[key] = {...parentVal, ...childVal }\r\n      } else {\r\n        options[key] = child[key] || parent[key]\r\n      }\r\n    }\r\n  } \r\n  return options\r\n}\r\n\r\nexport function isReservedTag (str) {\r\n  let reservedTag = 'a,div,span,p,img,button,ul,li'\r\n  // 源码更具“，”生成映射表 => {a: true, div:true,p:true}\r\n  return reservedTag.includes(str)\r\n}","import { mergeOptions } from \"../util\"\r\n\r\nexport function initGlobalApi(Vue) {\r\n  // Vue.component\r\n  // Vue.filter\r\n  // Vue.directive\r\n  Vue.options = {} // 用来存放全局的配置,每个组件初始化时,都会和options选项进行合并\r\n  Vue.mixin = function (options) {\r\n    // 第一次调用                     {}         {beforeCreate: Fn} => {beforeCreate: [fn]}\r\n    // 第二次调用        {beforeCreate: [fn]} {beforeCreate: Fn2} => {beforeCreate: [fn,fn2]}\r\n    this.options = mergeOptions(this.options, options)\r\n    return this\r\n  }\r\n\r\n  Vue.options._base = Vue//无论后续创建多少个子类,都可以通过_base找到Vue\r\n  Vue.options.components = {}\r\n  Vue.component = function(id, definition){\r\n    // 保证组件的隔离，每个组件都会产生一个新的类,去继承父类\r\n    definition = this.options._base.extend(definition)\r\n    this.options.components[id] = definition\r\n  }\r\n\r\n  // 给个对象返回一个类\r\n  Vue.extend = function(opts){// extend方法就是产生一个继承于Vue的类\r\n    // 并且身上应该有父类的所有功能\r\n    const Super = this\r\n    const Sub = function VueComponent(options) {\r\n      this._init(options)\r\n    }\r\n    //原型继承\r\n    Sub.prototype = Object.create(Super.prototype)\r\n    Sub.prototype.constructor = Sub\r\n    Sub.options = mergeOptions(Super.options, opts)//只和Vue.options合并\r\n    return Sub\r\n  }\r\n\r\n}\r\n","// 匹配大括号 {{}}\r\nvar defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g;// {{aaaa}}\r\n\r\nfunction genProps(attrs) {// [{name: 'xxxx', value: 'hello'}]\r\n  let str = ''\r\n  for(let i = 0; i < attrs.length; i++) {\r\n    let attr = attrs[i]\r\n    if (attr.name === 'style') {//style=\"border: 1px;font-size: 18px;\"\r\n      let styleObj = {}\r\n      attr.value.replace(/([^;:]+)\\:([^;:]+)/g, function() {\r\n        styleObj[arguments[1]] = arguments[2]\r\n      })\r\n      attr.value = styleObj\r\n    }\r\n    str += `${attr.name}:${JSON.stringify(attr.value)},`\r\n  }\r\n  // a: 1, b:2, slice去掉最后的逗号\r\n  return `{${str.slice(0, -1)}}`\r\n}\r\n\r\nfunction gen(el) {\r\n  if(el.type == 1) {\r\n    return generate(el)\r\n  } else {\r\n    let text = el.text\r\n    if(!defaultTagRE.test(text)) {\r\n      return `_v('${text}')`\r\n    } else {\r\n      // 'hello'+ arr + 'world'   hello {{arr}} world\r\n      let tokens = []\r\n      let match\r\n      let lastIndex = defaultTagRE.lastIndex = 0\r\n      while(match = defaultTagRE.exec(text)) {// 看有没有匹配到\r\n        let index = match.index; //开始索引\r\n        if (index > lastIndex) {\r\n          tokens.push(JSON.stringify(text.slice(lastIndex, index)))\r\n        }\r\n        tokens.push(`_s(${match[1].trim()})`) // JSON.stringify\r\n        lastIndex = index + match[0].length\r\n      }\r\n      if(lastIndex < text.length) {\r\n        tokens.push(JSON.stringify(text.slice(lastIndex)))\r\n      }\r\n\r\n      return `_v(${tokens.join('+')})`\r\n    }\r\n    \r\n  }\r\n}\r\n\r\nfunction genChildren(el) {\r\n  let children = el.children//获取儿子\r\n  if(children) {\r\n    return children.map(c=>gen(c)).join(',')\r\n  }\r\n}\r\n\r\nexport function generate(el) {// _c('div', {id: 'app'},_c('span', {}, 'world'), _v('hello'))\r\n  //遍历树,将树拼接成字符串\r\n  let children = genChildren(el)\r\n  let code = `_c('${el.tag}', ${\r\n      el.attrs.length? genProps(el.attrs) : 'undefined' \r\n    }${children? `,${children}`:'' \r\n  })`\r\n\r\n  return code\r\n}","// 标签名\r\nconst ncname = `[a-zA-Z_][\\\\-\\\\.0-9_a-zA-Z]*`;\r\n// 获取标签名 match后的索引为1的\r\nconst qnameCapture = `((?:${ncname}\\\\:)?${ncname})`;\r\n// 匹配开始标签\r\nconst startTagOpen = new RegExp(`^<${qnameCapture}`);\r\n// 匹配标签的关闭 <div/>\r\nconst startTagClose = /^\\s*(\\/?)>/;\r\n// 匹配闭合标签\r\nconst endTag = new RegExp(`^<\\\\/${qnameCapture}[^>]*>`);\r\n// 匹配属性 aa = \"xxx\" | 'xxx' | xxx  a=b a=\"b\" a ='b'\r\nconst attribute = /^\\s*([^\\s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/;\r\n// 匹配大括号 {{}}\r\nconst defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g;// {{aaaa}}\r\n\r\n\r\n\r\n// ast (语法层面的描述 js css html) vdom （dom节点）\r\n// html字符串解析成dom树 解析成对应的脚本  <div id = 'app'> {{name}} </div>\r\n\r\nexport function parserHTML(html) { // <div id=\"app\">111</div>\r\n  \r\n  //将解析后的结果 组装成一个树结构 ast树 栈\r\n\r\n  function createAstElement(tagName, attrs) {\r\n    return {\r\n      tag: tagName,\r\n      type: 1,\r\n      children: [],\r\n      parent: null,\r\n      attrs\r\n    }\r\n  } \r\n\r\n  let root = null\r\n  let stack = []\r\n  function start (tagName, attributes) {\r\n    let parent = stack[stack.length - 1]\r\n    let element = createAstElement(tagName, attributes)\r\n    if (!root) {\r\n      root = element\r\n    }\r\n\r\n    if (parent) {\r\n      element.parent = parent //当放入栈中时,记录父亲是谁\r\n      parent.children.push(element)\r\n    }\r\n    stack.push(element)\r\n  }\r\n\r\n  function end (tagName) {\r\n    let last = stack.pop()\r\n    if (last.tag !== tagName) {\r\n      throw new Error('标签有误')\r\n    }\r\n  }\r\n\r\n  function chars(text) {\r\n    text = text.replace(/\\s/g, \"\")\r\n    let parent = stack[stack.length - 1]\r\n    if (text) {\r\n      parent.children.push({\r\n        type: 3,\r\n        text\r\n      })\r\n    }\r\n\r\n  }\r\n\r\n  function advance(len){\r\n    html = html.substring(len)\r\n  }\r\n\r\n  function parseStartTag() {\r\n    const start = html.match(startTagOpen)\r\n    if(start){\r\n      const match = {\r\n        tagName: start[1],\r\n        attrs: []\r\n      }\r\n      // 去掉匹配到的开始标签\r\n      advance(start[0].length)\r\n      let end\r\n      // 如果没有遇到标签结尾就不停的解析\r\n      let attr\r\n      while (!(end  = html.match(startTagClose)) && (attr = html.match(attribute))) {\r\n        match.attrs.push({name: attr[1], value: attr[3] || attr[4] || attr[5]})\r\n        advance(attr[0].length)\r\n      } \r\n      if (end) {\r\n        advance(end[0].length)\r\n      } \r\n      return match\r\n    }\r\n    return false // 不是开始标签\r\n  }\r\n\r\n  while (html) { // 看解析的内容是否存在，如果存在就不停的解析\r\n    let textEnd = html.indexOf('<') // 当前解析的开头\r\n    if (textEnd == 0) {\r\n\r\n      const startTagMatch = parseStartTag() // 解析开始标签\r\n      if (startTagMatch) {\r\n        start(startTagMatch.tagName, startTagMatch.attrs)\r\n        continue\r\n      }\r\n\r\n      const endTagMatch = html.match(endTag)\r\n      if(endTagMatch) {\r\n        end(endTagMatch[1])\r\n        advance(endTagMatch[0].length)\r\n        continue\r\n      }\r\n    }\r\n    let text // 123123</div>\r\n    if(textEnd > 0) {\r\n      text = html.substring(0, textEnd)\r\n    }\r\n    if(text) {\r\n      chars(text)\r\n      advance(text.length)\r\n    }\r\n  }\r\n  return root\r\n}\r\n\r\n// 看一下用户是否传入了render，没传入可能传入的事template，template如果也没传就解析\r\n// html => 词法解析（开始标签 ，结束标签， 属性， 文本） => ast语法树 用来描述html语法的 stack = []\r\n// codegen函数将<div>hello</div> => _c('div', {}, 'hello') => 让字符串执行\r\n// 字符串转为代码  eval 耗性能 会有作用域问题\r\n\r\n// 模版引擎 通过new Function + with 来实现","import { generate } from \"./generate\";\r\nimport { parserHTML } from \"./parser\";\r\n\r\n\r\nexport function compileToFunction(template) {\r\n  \r\n  let root = parserHTML(template)\r\n  //生成代码\r\n  console.log(root, 'root')\r\n  let code = generate(root)\r\n  console.log(code, 'code')\r\n  let render = new Function(`with(this){return ${code}}`) //code中会用到数据,数据在vm上\r\n\r\n  return render\r\n\r\n  // render(){\r\n  //   return _c('div', {id: 'app'}, 'hello')\r\n  // }\r\n   \r\n  // 虚拟dom\r\n  // {tag: div, data:{id: 'app', a:1},children: [{text:'hello'}]}\r\n\r\n  // html => ast（只能描述语法 语法不存在的属性无法描述） => render函数 (with + new Function) => 虚拟dom (增加额外的属性) => 生成真实dom\r\n\r\n  \r\n}\r\n\r\n// with用法\r\n// let vm = {arr: 1}\r\n// with(vm) {\r\n//   console.log(arr) // 1\r\n// }\r\n","let id = 0\r\nclass Dep{//每个属性都分配一个dep，dep可以来存放watcher，watcher中还要存放dep\r\n  constructor() {\r\n    this.id = id++\r\n    this.subs = []//用来存放watcher\r\n  }\r\n  depend() {\r\n    // Dep.target dep里要存放watcher ， watcher要存放dep  多对多的关系\r\n    if(Dep.target) {\r\n      Dep.target.addDep(this)\r\n    }\r\n  }\r\n  addSub(watcher) {\r\n    this.subs.push(watcher)\r\n  }\r\n  notify() {\r\n    this.subs.forEach(watcher => watcher.update())\r\n  }\r\n}\r\nDep.target = null//所有组件公用\r\nlet stack = []\r\n\r\nexport function pushTarget(watcher) {\r\n  Dep.target = watcher\r\n  stack.push(watcher)\r\n}\r\n\r\nexport function popTarget() {\r\n  stack.pop()\r\n  Dep.target = stack[stack.length - 1]\r\n}\r\nexport default Dep","import { nextTick } from \"../util\"\r\n\r\n//用于watcher的调度工作\r\nlet queue = []\r\nlet has = {}//做列表 列表存放了哪些watcher\r\n\r\nfunction flushSchedulerQueue() {\r\n  for(let i = 0; i < queue.length; i++) {\r\n    queue[i].run()\r\n  }\r\n  queue = []\r\n  has = {}\r\n  pending = false\r\n}\r\n\r\nlet pending = false\r\n\r\n// 等待同步代码执行完后 才执行逻辑(event loop)\r\nexport function queueWatcher(watcher) {// 同步代码执行完毕后先清空微任务,再清空宏任务,想尽早更新页面\r\n  const id = watcher.id\r\n  if(has[id] == null) {\r\n    queue.push(watcher)\r\n    has[id] = true\r\n\r\n    // 开启一次更新操作 批处理（防抖）\r\n    if(!pending) {\r\n      // 定时器会开启新的线程\r\n      // setTimeout(flushSchedulerQueue, 0)\r\n      nextTick(flushSchedulerQueue)\r\n      pending = true\r\n    }\r\n  }\r\n}","import { popTarget, pushTarget } from \"./dep\"\r\nimport { queueWatcher } from \"./scheduler\"\r\n\r\nlet id = 0\r\nclass Watcher {\r\n   // vm, updateComponent, () => {回调}, true\r\n  constructor(vm, exprOrFn, cb, options) {\r\n    this.vm = vm\r\n    this.exprOrFn = exprOrFn// exprOrFn\r\n    this.user = !!options.user//是不是用户watcher\r\n    this.cb = cb\r\n    this.dirty = options.lazy // 如果是计算属性, 那麽默认值lazy: true, dirty: true\r\n    this.lazy = !!options.lazy\r\n    this.options = options\r\n    this.id = id++\r\n    this.deps = []\r\n    this.depsId = new Set()\r\n    if(typeof exprOrFn == 'string') {\r\n      this.getter = function() {//需要将表达式转成函数\r\n        //当数据取值时会进行依赖收集 age.n => vm['age]['n']\r\n        let path = exprOrFn.split('.') // [age, n]\r\n        let obj = vm\r\n        for(let i = 0; i < path.length; i++) {\r\n          obj = obj[path[i]]\r\n        }\r\n        return obj\r\n      }\r\n    } else {\r\n      // 默认应该执行exprOrFn， render(去vm上取值)\r\n      this.getter = exprOrFn\r\n    }\r\n    // 第一次的value\r\n    this.value = this.lazy? undefined: this.get() // 默认初始化要取值\r\n  }\r\n\r\n  get() { //用户更新时可以重新调用get\r\n    // 取值时会调defineProperty.get方法， 每个属性都可以收集自己的watcher，一个属性对应多个watcher，一个watcher可以对应多个属性\r\n    pushTarget(this)\r\n    const value = this.getter.call(this.vm)\r\n    popTarget()// Dep.target = null, 如果Dep.target有值说明这个变量在模板中使用了\r\n\r\n    return value\r\n  }\r\n  addDep(dep) {\r\n    let id = dep.id\r\n    if(!this.depsId.has(id)) {\r\n      this.depsId.add(id)\r\n      this.deps.push(dep)\r\n      dep.addSub(this)\r\n    }\r\n  }\r\n  update() { // vue中的更新操作是异步的\r\n    // this.get()\r\n    if (this.lazy) {\r\n      this.dirty = true\r\n    } else {\r\n      // 每次更新时 this=> watcher\r\n      queueWatcher(this) //多次调用update 先将watcher缓存下来,等一会一起更新\r\n    }\r\n    \r\n  }\r\n  run() {\r\n    let newValue = this.get()\r\n    let oldValue = this.value\r\n    this.value = newValue //为了保证下一次更新时 上一次的最新值时下一次的旧值\r\n    if (this.user) {\r\n      this.cb.call(this.vm, newValue, oldValue)\r\n    }\r\n  }\r\n  evaluate() {\r\n    this.dirty = false //false表示取过值了 \r\n    this.value =  this.get()//用户的getter执行\r\n  }\r\n  depend() {\r\n    let i = this.deps.length\r\n    while(i--) {\r\n      this.deps[i].depend()//name friends收集watcher\r\n    }\r\n  }\r\n }\r\n\r\n // watcher 和dep\r\n //将更新的功能封装成一个watcher\r\n // 渲染前会将当前watcher放在Dep类上\r\n // 在vue中页面渲染时使用的属性,需要进行依赖收集,收集对象的渲染watcher\r\n // 取值时,给每个属性都加dep属性,用于储存这个渲染watcher （同一个watcher会对应多个dep）\r\n // 每个属性可能对应多个视图（多个视图多个watcher） 一个属性要对应多个watcher\r\n // dep.depend（） => 通知dep存放watcher => Dep.target.addDep() => 通知watcher存放dep\r\n // 双向存储\r\n export default Watcher","\r\nexport function patch(oldVnode, vnode) {\r\n  if (!oldVnode) {\r\n    return createElm(vnode) // 如果没有el元素，那就直接根据虚拟节点返回真实节点\r\n  }\r\n  if(oldVnode.nodeType == 1) {\r\n    //用vnode生成真实dom，替换原本的dom元素\r\n    const parentElm = oldVnode.parentNode //找到它的父亲\r\n    let elm = createElm(vnode) // 根据虚拟节点 创建元素\r\n    parentElm.insertBefore(elm, oldVnode.nextSibling)\r\n    // 第一次渲染删除节点，下次再使用无法获取\r\n    parentElm.removeChild(oldVnode)\r\n    return elm\r\n  } else {\r\n    // 如果标签名称不一样 直接删掉老的换成新的即可\r\n    if(oldVnode.tag !== vnode.tag) {\r\n      // 可以通过vnode.el属性获取现在的真实dom\r\n      return oldVnode.el.parentNode.replaceChild(createElm(vnode), oldVnode.el)\r\n    }\r\n    \r\n\r\n    let el = vnode.el = oldVnode.el //表示当新节点复用老节点\r\n    \r\n    // 如果两个虚拟节点是文本节点 比较文本内容\r\n    if(vnode.tag == undefined) {//新老都是文本\r\n      if(oldVnode.text !== vnode.text) {\r\n        el.textContent = vnode.text\r\n      }\r\n      return\r\n    }\r\n    //如果标签一样 比较属性,传入新的虚拟节点,和老的属性，用新的属性更新老的\r\n    patchProps(vnode, oldVnode.data)\r\n    // 属性可能有删除的情况\r\n\r\n    // 一方有儿子 一方没儿子\r\n    let oldChildren = oldVnode.children || []\r\n    let newChildren = vnode.children || []\r\n    if(oldChildren.length > 0 && newChildren.length > 0) {\r\n      // 双方都有儿子\r\n      // vue用了双指针方法比对 同层比对\r\n      patchChildren(el, oldChildren, newChildren)\r\n\r\n\r\n    } else if (newChildren.length > 0) { // 老的没儿子,但是新的有儿子\r\n      for (let i = 0; i < newChildren.length; i++) {\r\n        let child = createElm(newChildren[i])\r\n        el.appendChild(child) // 循环创建新节点\r\n      }\r\n    } else if (oldChildren.length > 0){ // 老的有儿子 新的没儿子\r\n      el.innerHTML = `` //直接删除老节点\r\n    }\r\n    // vue的特点是每个组件都有一个watcher，当前数组中的数据变化 只需要更新当前组件\r\n    \r\n  }\r\n}\r\n\r\nfunction isSameVnode(oldVnode, newVnode) {\r\n  return (oldVnode.tag == newVnode.tag) && (oldVnode.key == newVnode.key)\r\n}\r\n\r\nfunction patchChildren (el, oldChildren, newChildren) {\r\n\r\n  let oldStartIndex = 0\r\n  let oldStartVnode = oldChildren[0]\r\n  let oldEndIndex = oldChildren.length - 1\r\n  let oldEndVode = oldChildren[oldEndIndex]\r\n\r\n  let newStartIndex = 0\r\n  let newStartVnode = newChildren[0]\r\n  let newEndIndex = newChildren.length - 1\r\n  let newEndVode = newChildren[newEndIndex]\r\n\r\n  while(oldStartIndex <= oldEndIndex && newStartIndex <= newEndIndex) {\r\n    // 同时循环新的节点和老的节点，有一方循环完毕就结束了\r\n    if(isSameVnode(oldStartVnode, newStartVnode)) { //头头比较，标签一致，\r\n      patch(oldStartVnode, newStartVnode)\r\n      oldStartVnode = oldChildren[++oldStartIndex]\r\n      newStartVnode = newChildren[++newStartIndex]\r\n    } else if(isSameVnode(oldEndVode, newEndVode)) {\r\n      patch(oldStartVnode, newStartVnode)\r\n      oldEndVnode = oldChildren[--oldEndIndex]\r\n      newEndVnode = newChildren[--newEndIndex]\r\n    }\r\n  }\r\n  \r\n  // 用户追加一个元素\r\n\r\n  // 尾部追加\r\n  if (newStartIndex <= newEndIndex) {\r\n    for(let i = newStartIndex; i <= newEndIndex; i++) {\r\n      // el.appendChild(createElm(newChildren[i]))\r\n      // insertBefore方法可以实现appendChild功能\r\n\r\n      // 判断尾指针的下一个元素是否存在\r\n      let anchor = newChildren[newEndIndex + 1] == null? null : newChildren[newEndIndex + 1].el\r\n      // node.insertBefore(newnode,existingnode) newnode:必需。需要插入的节点对象。existingnode 可选。在其之前插入新节点的子节点。如果未规定，则 insertBefore 方法会在结尾插入 newnode。\r\n      el.insertBefore(createElm(newChildren[i]),anchor)\r\n    }\r\n  }\r\n\r\n}\r\n\r\n// 创建真实节点\r\nfunction patchProps(vnode, oldProps = {}) { // 初次渲染时可以调用此方法,后续更新也可以调用此方法\r\n  let newProps = vnode.data || {}\r\n  let el = vnode.el\r\n  // 如果老的属性有,新的属性没有 直接删除\r\n  let newStyle = newProps.style || {}\r\n  let oldStyle = oldProps.style || {}\r\n\r\n  for(let key in oldStyle) {\r\n    if (!newStyle[key]) { //新的里边不存在这个样式\r\n      el.style[key] = ''\r\n    }\r\n  }\r\n  for(let key in oldProps) {\r\n    if (key === 'style') {\r\n\r\n    }\r\n    if(!newProps[key]) {\r\n      el.removeAttribute(key)\r\n    }\r\n  }\r\n  for(let key in newProps) {\r\n    if(key === 'style') {\r\n      for(let styleName in newProps.style) {\r\n        el.style[styleName] = newProps.style[styleName]\r\n      }\r\n    } else {\r\n      el.setAttribute(key, newProps[key])\r\n    }\r\n    \r\n  }\r\n\r\n}\r\n\r\nfunction createComponent(vnode) {\r\n  let i = vnode.data\r\n  if ((i = i.hook) && (i = i.init)) {\r\n    i(vnode)//调用init方法\r\n  }\r\n  if(vnode.componentInstance) { //有属性说明子组件new完毕了，并且组件对应的真实dom挂载到了vnode.componentInstance.$el上\r\n    return true\r\n  }\r\n}\r\n\r\n//创建真实节点\r\nexport function createElm(vnode) {\r\n  let {tag, data, children, text, vm} = vnode\r\n  if(typeof tag === 'string') { // 元素\r\n\r\n    if(createComponent(vnode)) {\r\n      //返回组件对应的真实节点\r\n      return vnode.componentInstance.$el\r\n\r\n    }\r\n\r\n    vnode.el = document.createElement(tag) //虚拟节点会有一个el属性,对应真实节点\r\n    patchProps(vnode)\r\n    children.forEach(child => {\r\n      vnode.el.appendChild(createElm(child))\r\n    })\r\n\r\n\r\n  } else {\r\n    vnode.el = document.createTextNode(text)\r\n  }\r\n  return vnode.el\r\n}","import Watcher from \"./observer/watcher\"\r\nimport { patch } from \"./vdom/patch\"\r\n\r\n\r\nexport function lifecycleMixin(Vue) {\r\n  Vue.prototype._update = function(vnode) {\r\n    // 既有初始化,又有更新\r\n    const vm = this\r\n    console.log(vm.$el, vnode, '12')\r\n    vm.$el = patch( vm.$el, vnode)\r\n\r\n  }\r\n  Vue.prototype.$nextTick = function () {\r\n    \r\n  }\r\n}\r\n// 后续每个组件渲染的时候都会有一个watcher\r\nexport function mountComponent(vm, el) {\r\n\r\n  // 更新函数 数据变化后 会再次调用此函数\r\n  let updateComponent = () => {\r\n    //调用render函数,生成虚拟dom\r\n    vm._update(vm._render()) // 后续更新可以调用updateComponent方法\r\n    // 用虚拟dom,生成真实dom\r\n  }\r\n  callHook(vm, 'beforeMount')\r\n  //观察者模式：属性是被观察者 观察者：刷新页面 \r\n  // updateComponent()\r\n  new Watcher(vm, updateComponent, () => {\r\n    // 回调\r\n  }, true)//true表示是一个渲染watcher 还有其他watcher\r\n  callHook(vm, 'mounted')\r\n\r\n}\r\n\r\nexport function callHook(vm, hook) {\r\n  let handlers = vm.$options[hook]\r\n  if(handlers) {\r\n    for(let i = 0; i < handlers.length; i++) {\r\n      handlers[i].call(vm)\r\n    }\r\n  }\r\n}","let oldArrayPrototype = Array.prototype\r\n// 继承数组方法（保留原有数组功能）\r\nexport let arrayMethods = Object.create(oldArrayPrototype)\r\n// arrayMethods.__proto__ = Array.prototype \r\n\r\n//只有这7个可以改变原数组\r\nlet methods = [\r\n  'push',\r\n  'shift',\r\n  'unshift',\r\n  'pop',\r\n  'reverse',\r\n  'sort',\r\n  'splice'\r\n]\r\n\r\nmethods.forEach(method => {\r\n  // 用户调用的如果是以上七个方法,会用重写的,负责调用原来的数组方法\r\n  arrayMethods[method] = function (...args) {\r\n    // 此处this是数组\r\n    oldArrayPrototype[method].call(this, ...args)\r\n    let inserted\r\n    let ob = this.__ob__//根据当前数组获取observe实例\r\n    switch(method){\r\n      case 'push':\r\n      case 'unshift':\r\n        inserted = args // 就是新增的内容\r\n        break\r\n      case 'splice':\r\n        inserted = args.slice(2)\r\n        break\r\n      default: \r\n        break\r\n    }\r\n    // 如果有新增的内容要继续劫持 需要观测数组每一项,而不是数组\r\n    if(inserted) ob.observeArray(inserted)\r\n    // 数组的observer.dep属性\r\n    ob.dep.notify()\r\n    // arr.push({a:1}, {b:2})\r\n    // arr.splice(0, 1, xxxx)\r\n  }\r\n})\r\n\r\n// vue中的嵌套数据不能太深\r\n// vue中对象通过的是defineProperty实现的响应式,拦截了get和set,如果不存在的属性不会拦截，也不会响应。可以使用$set =>让对象自己去notify，或者赋一个新对象\r\n// vue中的数组改索引和长度,是不会影响更新的,通过变异方法更新视图，7个方法，数组中如果修改对象类型,修改对象也可以更新视图","import { isObject } from \"../util\";\r\nimport { arrayMethods } from \"./array\";\r\nimport Dep from './dep'\r\n\r\n// 1.如果数据是对象 会将对象不停的递归 进行劫持\r\n// 2.如果是数组, 会劫持数组的方法 并对数组中不是基本数据类型的进行检测\r\n\r\n//检测数据变化，类有类型,对象无类型\r\n\r\n// 如果给对象新增一个属性不会触发视图更新（给对象本身也增加一个dep，dep中存watcher，如果增加一个属性后，就手动触发watcher的更新）\r\nclass Observer{\r\n  constructor(data) {//对对象中的所有属性进行劫持\r\n\r\n    this.dep = new Dep()//数据可能是数组或者对象\r\n\r\n    Object.defineProperty(data, '__ob__', {\r\n      value: this,\r\n      enumerable: false //不可枚举\r\n    })\r\n    // data.__ob__ = this //所有被劫持过的属性都有__ob__\r\n    if(Array.isArray(data)) {\r\n      //数组劫持，对数组原来方法改写,切片编程\r\n      data.__proto__  = arrayMethods\r\n      //如果数组中的数据是对象类型,需要监控对象的变化\r\n      this.observeArray(data)\r\n    }else {\r\n      this.walk(data) //对象劫持\r\n    }\r\n  }\r\n\r\n  observeArray(data) { //对数组中的数组和数组中的对象再次劫持\r\n    //如果数组里放的是对象类型，也做了观测，JSON.stringify()也做了收集依赖\r\n    data.forEach(item => {\r\n      observe(item)\r\n    })\r\n  }\r\n\r\n  walk(data) {//传入的对象\r\n    Object.keys(data).forEach(key => {\r\n      defineReactive(data, key, data[key])\r\n    })\r\n  }\r\n}\r\nfunction dependArray(value) {\r\n  for(let i = 0; i < value.length; i++ ) {\r\n    let current = value[i]\r\n    current.__ob__ && current.__ob__.dep.depend()\r\n    if(Array.isArray(current)) {\r\n      dependArray(current)\r\n    }\r\n  }\r\n}\r\n\r\n//vue2会对对象进行遍历,将每个属性用defineProperty重新定义,所以导致性能差\r\nfunction defineReactive(data, key, value){//value有可能是对象\r\n  let childOb = observe (value)//本身用户默认值是对象套对象,需要递归处理（性能差）\r\n  let dep = new Dep()//每个属性都有一个dep属性\r\n  Object.defineProperty(data, key,{\r\n    get() {\r\n      //取值时将watcher将dep关联起来\r\n      if(Dep.target) {//此值是在模版中取值的\r\n        dep.depend()//让dep记住watcher\r\n        if(childOb) { //可能是数组，也可能是对象\r\n          childOb.dep.depend() //让数组和对象也记录watcher\r\n          if(Array.isArray(value)) {\r\n            dependArray(value)\r\n          }\r\n        }\r\n      }\r\n      return value\r\n    },\r\n    set(newV) {\r\n      // 更新视图\r\n      if (newV !== value) {\r\n        observe (newV)// 如果用户赋值一个新对象,需要将这个对象进行劫持\r\n        value = newV\r\n        dep.notify()//告诉当前的属性存放的watcher执行\r\n      }\r\n    }\r\n  })\r\n}\r\n\r\nexport function observe (data) {\r\n  //如果是对象类型才观测\r\n  if(!isObject(data)) {\r\n    return\r\n  }\r\n  //判断data有没有被观测\r\n  if(data.__ob__) {\r\n    return data.__ob__\r\n  }\r\n  return new Observer(data)\r\n}","import Dep from \"./observer/dep\"\r\nimport { observe } from \"./observer/index\"\r\nimport Watcher from \"./observer/watcher\"\r\nimport { isFunction } from \"./util\"\r\n\r\n\r\nexport function stateMixin(Vue) {\r\n  Vue.prototype.$watch = function (key, handler,options = {}) {\r\n    options.user = true //是一个用户写的watcher\r\n    let watcher = new Watcher(this, key, handler, options)\r\n\r\n    if(options.immediate) {\r\n      handler(watcher.value)\r\n    }\r\n  }\r\n}\r\n// 状态初始化\r\nexport function initState(vm) {\r\n  const opts = vm.$options\r\n  // if (opts.props) {\r\n  //   initProps()\r\n  // }\r\n  if (opts.data) {\r\n    initData(vm)\r\n  }\r\n  if (opts.computed) {\r\n    initComputed(vm, opts.computed)\r\n  }\r\n  if (opts.watch) {// 初始化watch\r\n    initWatch(vm, opts.watch)\r\n  }\r\n}\r\n\r\n// 代理\r\nfunction proxy(vm, source, key) {\r\n  Object.defineProperty(vm, key, {\r\n    get() {\r\n      return vm[source][key]\r\n    },\r\n    set(newVal) {\r\n      vm[source][key] = newVal\r\n    }\r\n  })\r\n}\r\n\r\nfunction initData(vm) {\r\n  let data = vm.$options.data // vm.$el vue内部会对属性检测如果以$开头 不会进行代理\r\n  // vue2会将data中的所有数据进行劫持 Object.defineProperty\r\n  //这个时候data和vm没有任何关系,通过_data进行关联\r\n  data = vm._data =isFunction(data)?data.call(vm): data\r\n\r\n  for(let key in data) { //取name时直接可以写vm.name vm.xxx => vm._data.xxx\r\n    proxy(vm, '_data', key)\r\n  }\r\n  \r\n  observe(data)\r\n}\r\n\r\nfunction initWatch(vm, watch) {\r\n  for(let key in watch) {\r\n    console.log(key, watch, 'watch')\r\n    let handler = watch[key]\r\n    if (Array.isArray(handler)) {\r\n      for(let i = 0; i < handler.length; i++) {\r\n        createWatcher(vm, key, handler[i])\r\n      }\r\n    } else {\r\n      createWatcher(vm, key, handler)\r\n    }\r\n  }\r\n}\r\n\r\nfunction createWatcher(vm, key, handler) {\r\n  return vm.$watch(key, handler)\r\n}\r\n\r\nfunction initComputed(vm, computed) {\r\n  const watchers = vm._computedWatchers = {}\r\n  for(let key in computed) {\r\n    const userDef = computed[key]\r\n\r\n    // 依赖的属性变化就重新赋值 get\r\n    let getter = typeof userDef == 'function'? userDef: userDef.get\r\n    // 每个计算属性本质就是watcher\r\n    //将watcher和属性做一个映射\r\n    watchers[key] = new Watcher(vm, getter, ()=>{}, {lazy: true})// 默认不执行\r\n    // 将key定义在vm上\r\n    defineComputed(vm, key, userDef)\r\n  }\r\n}\r\n\r\nfunction createComputedGetter (key) {\r\n  return function computedGetter() {// 取计算属性的值执行这个函数\r\n    //this._computedWatchers包含所有的计算属性\r\n    // 通过key可以拿到对应的watcher,这个watcher中包含了getter\r\n    let watcher = this._computedWatchers[key]\r\n    //脏需要调用用户getter\r\n    if(watcher.dirty) {//根据dirty属性判断是否重新求值\r\n      watcher.evaluate()\r\n    }\r\n\r\n    // 如果当前取完值后,Dep.target还有值需要继续向上收集\r\n    if(Dep.target) {\r\n      // 计算属性watcher内部有两个dep\r\n      watcher.depend()// watcher里对应了多个dep\r\n    }\r\n\r\n    return watcher.value\r\n  }\r\n}\r\n\r\nfunction defineComputed(vm, key, userDef) {\r\n  let sharedProperty = {}\r\n  if(typeof userDef == 'function') {\r\n    sharedProperty.get = userDef\r\n  } else {\r\n    sharedProperty.get = createComputedGetter(key)\r\n    sharedProperty.set = userDef.set\r\n  }\r\n  Object.defineProperty(vm, key, sharedProperty)\r\n}","import { compileToFunction } from \"./compiler/index\"\r\nimport { callHook, mountComponent } from \"./lifecycle\"\r\nimport { initState } from \"./state\"\r\nimport { mergeOptions } from \"./util\"\r\n\r\nexport function initMixin(Vue) { //表示在vue的基础上做一次混合操作\r\n  Vue.prototype._init = function (options) {\r\n    const vm = this\r\n    vm.$options = mergeOptions(vm.constructor.options,options)//后面会对options进行扩展\r\n    // 对数据进行初始化\r\n    callHook(vm, 'beforeCreate')\r\n    initState(vm)//vm.$options.data 数据劫持\r\n    callHook(vm, 'created')\r\n\r\n    \r\n    if(vm.$options.el) {\r\n      // 将数据挂载到这个模板上\r\n      vm.$mount(vm.$options.el)\r\n    }\r\n  }\r\n\r\n  Vue.prototype.$mount = function (el) {\r\n    const vm = this\r\n    const options = vm.$options\r\n    el = document.querySelector(el)\r\n    vm.$el = el\r\n    console.log(el ,'el')\r\n\r\n    // 把模版转换成 对应的渲染函数 =》 虚拟dom vnode diff算法 更新虚拟dom => 真实dom\r\n\r\n    if(!options.render) { // 没有render用template\r\n      let template = options.template\r\n      if(!template && el) {// 没有template就取el的内容作为模板\r\n        template = el.outerHTML\r\n        \r\n      }\r\n      let render = compileToFunction(template)\r\n      options.render = render\r\n    }\r\n    // options.render就是渲染函数\r\n    // 调用render方法 渲染成真实dom 替换掉页面的内容\r\n\r\n    mountComponent(vm, el) // 组件挂载过程\r\n  }\r\n\r\n}\r\n\r\n","import { isObject, isReservedTag } from \"../util\"\r\n\r\nexport function createElement(vm, tag, data={}, ...children) {\r\n  // 如果tag是组件 应该渲染一个组件的vnode\r\n  if(isReservedTag(tag)) {\r\n    return vnode(vm, tag, data, data.key, children, undefined)\r\n  } else {\r\n    const Ctor = vm.$options.components[tag]\r\n    return createComponent(vm, tag, data, data.key, children, Ctor)\r\n  }\r\n  \r\n}\r\n\r\n//创建组件的虚拟节点 为了区分组件和元素 data.hook componentOptions\r\nfunction createComponent(vm, tag, data, key, children, Ctor) {\r\n  // 组件的构造函数\r\n  if(isObject(Ctor)) {\r\n    Ctor = vm.$options._base.extend(Ctor)// Vue.extend\r\n  }\r\n  data.hook = {//渲染组件时，需要调用此初始化方法\r\n    init(vnode){\r\n      let vm = vnode.componentInstance =  new Ctor({_isComponent: true}) //new Sub 会用此选项和组件的配置进行合并\r\n      vm.$mount()//组件挂载完成后 会在vm.$el赋值 vnode.componentInstance.$el => button\r\n    }\r\n  }\r\n\r\n  return vnode(vm, `vue-component-${tag}`, data,key,undefined,undefined,{Ctor, children})\r\n}\r\n\r\nexport function createTextElement(vm, text) {\r\n  return vnode(vm, undefined, undefined, undefined, undefined, text)\r\n}\r\n\r\nfunction vnode(vm, tag, data, key, children, text, componentOptions){\r\n\r\n  return {\r\n    vm,\r\n    tag,\r\n    data,\r\n    key,\r\n    children,\r\n    text,\r\n    componentOptions\r\n  }\r\n\r\n}","import { createElement, createTextElement } from \"./vdom/index\"\r\n\r\nexport function renderMixin(Vue) {\r\n  Vue.prototype._c = function() {//createElement\r\n    return createElement(this,...arguments)\r\n  }\r\n  Vue.prototype._v = function(text) { //createTextElement\r\n    return createTextElement(this,text)\r\n  }\r\n  Vue.prototype._s = function(val) {// stringify\r\n    if(typeof val === 'object') return JSON.stringify(val)\r\n    return val\r\n  }\r\n\r\n  Vue.prototype._render = function() {\r\n    const vm = this\r\n    let render = vm.$options.render // 解析出来的render方法,同时也可能是用户写的\r\n\r\n    let vnode = render.call(vm)\r\n\r\n    return vnode\r\n  }\r\n}","//用class类写vue不好拆封,所以采用构造函数方式写\r\n\r\nimport { initGlobalApi } from './global-api/index'\r\nimport { initMixin } from './init'\r\nimport { lifecycleMixin } from './lifecycle'\r\nimport { renderMixin } from './render'\r\nimport { stateMixin } from './state'\r\n\r\nfunction Vue(options) {\r\n  // options用户传入选项\r\n  //构造函数中的this指向new的实例\r\n  this._init(options)// 初始化操作\r\n}\r\n// 扩展原型\r\ninitMixin(Vue)\r\nrenderMixin(Vue) // _render\r\nlifecycleMixin(Vue) // _update\r\nstateMixin(Vue)\r\n\r\n\r\n// 在类上扩展\r\ninitGlobalApi(Vue) //初始化全局api\r\n\r\nimport { compileToFunction } from './compiler/index'\r\nimport { createElm, patch } from './vdom/patch'\r\n// diff核心\r\nlet oldTemplate = `<div style = \"color:red;background:blue\" a = \"1\"><li>A</li><li a = \"1\">B</li><li>C</li><li>D</li></div>`\r\n\r\nlet vm1 = new Vue({data: {message: 'hello'}})\r\nconst render1 = compileToFunction(oldTemplate)\r\nconst oldVnode = render1.call(vm1) //虚拟dom\r\ndocument.body.appendChild(createElm(oldVnode))\r\n\r\n\r\nlet newTemplate = `<div style = \"color:red;background:blue\" b = \"1\"><li>A</li><li>B</li><li>C</li><li>D</li><li>E</li></div>`\r\nlet vm2 = new Vue({data: {message: 'hello1'}})\r\nconst render2 = compileToFunction(newTemplate)\r\nconst newVnode = render2.call(vm2) //虚拟dom\r\n\r\n// 根据新的虚拟节点更新老的节点，老的节点能复用就复用\r\nsetTimeout(() => {\r\n  patch(oldVnode, newVnode)\r\n}, 2000)\r\n\r\n\r\nexport default Vue"],"names":["isFunction","val","isObject","callbacks","flushCallbacks","forEach","cb","waiting","timer","timerFn","Promise","resolve","then","MutationObserver","textNode","document","createTextNode","observe","characterData","textContent","setImmedidate","setTimeout","nextTick","push","lifecycleHooks","mergeHook","parentVal","childVal","concat","strats","hook","components","options","Object","create","key","mergeOptions","parent","child","mergeField","hasOwnProperty","isReservedTag","str","reservedTag","includes","initGlobalApi","Vue","mixin","_base","component","id","definition","extend","opts","Super","Sub","VueComponent","_init","prototype","constructor","defaultTagRE","genProps","attrs","i","length","attr","name","styleObj","value","replace","arguments","JSON","stringify","slice","gen","el","type","generate","text","test","tokens","match","lastIndex","exec","index","trim","join","genChildren","children","map","c","code","tag","ncname","qnameCapture","startTagOpen","RegExp","startTagClose","endTag","attribute","parserHTML","html","createAstElement","tagName","root","stack","start","attributes","element","end","last","pop","Error","chars","advance","len","substring","parseStartTag","textEnd","indexOf","startTagMatch","endTagMatch","compileToFunction","template","console","log","render","Function","Dep","subs","target","addDep","watcher","update","pushTarget","popTarget","queue","has","flushSchedulerQueue","run","pending","queueWatcher","Watcher","vm","exprOrFn","user","dirty","lazy","deps","depsId","Set","getter","path","split","obj","undefined","get","call","dep","add","addSub","newValue","oldValue","depend","patch","oldVnode","vnode","createElm","nodeType","parentElm","parentNode","elm","insertBefore","nextSibling","removeChild","replaceChild","patchProps","data","oldChildren","newChildren","patchChildren","appendChild","innerHTML","isSameVnode","newVnode","oldStartIndex","oldStartVnode","oldEndIndex","oldEndVode","newStartIndex","newStartVnode","newEndIndex","newEndVode","oldEndVnode","newEndVnode","anchor","oldProps","newProps","newStyle","style","oldStyle","removeAttribute","styleName","setAttribute","createComponent","init","componentInstance","$el","createElement","lifecycleMixin","_update","$nextTick","mountComponent","updateComponent","_render","callHook","handlers","$options","oldArrayPrototype","Array","arrayMethods","methods","method","args","inserted","ob","__ob__","observeArray","notify","Observer","defineProperty","enumerable","isArray","__proto__","walk","item","keys","defineReactive","dependArray","current","childOb","set","newV","stateMixin","$watch","handler","immediate","initState","initData","computed","initComputed","watch","initWatch","proxy","source","newVal","_data","createWatcher","watchers","_computedWatchers","userDef","defineComputed","createComputedGetter","computedGetter","evaluate","sharedProperty","initMixin","$mount","querySelector","outerHTML","Ctor","_isComponent","createTextElement","componentOptions","renderMixin","_c","_v","_s","oldTemplate","vm1","message","render1","body","newTemplate","vm2","render2"],"mappings":"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"}