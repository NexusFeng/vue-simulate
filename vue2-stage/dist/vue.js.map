{"version":3,"file":"vue.js","sources":["../src/compiler/generate.js","../src/compiler/parser.js","../src/compiler/index.js","../src/vdom/patch.js","../src/lifecycle.js","../src/util.js","../src/observer/array.js","../src/observer/index.js","../src/state.js","../src/init.js","../src/vdom/index.js","../src/render.js","../src/index.js"],"sourcesContent":["// 匹配大括号 {{}}\nvar defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g;// {{aaaa}}\n\nfunction genProps(attrs) {// [{name: 'xxxx', value: 'hello'}]\n  let str = ''\n  for(let i = 0; i < attrs.length; i++) {\n    let attr = attrs[i]\n    if (attr.name === 'style') {//style=\"border: 1px;font-size: 18px;\"\n      let styleObj = {}\n      attr.value.replace(/([^;:]+)\\:([^;:]+)/g, function() {\n        styleObj[arguments[1]] = arguments[2]\n      })\n      attr.value = styleObj\n    }\n    str += `${attr.name}:${JSON.stringify(attr.value)},`\n  }\n  // a: 1, b:2, slice去掉最后的逗号\n  return `{${str.slice(0, -1)}}`\n}\n\nfunction gen(el) {\n  if(el.type == 1) {\n    return generate(el)\n  } else {\n    let text = el.text\n    if(!defaultTagRE.test(text)) {\n      return `_v(${text})`\n    } else {\n      // 'hello'+ arr + 'world'   hello {{arr}} world\n      let tokens = []\n      let match\n      let lastIndex = defaultTagRE.lastIndex = 0\n      while(match = defaultTagRE.exec(text)) {// 看有没有匹配到\n        let index = match.index; //开始索引\n        if (index > lastIndex) {\n          tokens.push(JSON.stringify(text.slice(lastIndex, index)))\n        }\n        tokens.push(`_s(${match[1].trim()})`) // JSON.stringify\n        lastIndex = index + match[0].length\n      }\n      if(lastIndex < text.length) {\n        tokens.push(JSON.stringify(text.slice(lastIndex)))\n      }\n\n      return `_v(${tokens.join('+')})`\n    }\n    \n  }\n}\n\nfunction genChildren(el) {\n  let children = el.children//获取儿子\n  if(children) {\n    return children.map(c=>gen(c)).join(',')\n  }\n}\n\nexport function generate(el) {// _c('div', {id: 'app'},_c('span', {}, 'world'), _v('hello'))\n  //遍历树,将树拼接成字符串\n  let children = genChildren(el)\n  let code = `_c('${el.tag}', ${\n      el.attrs.length? genProps(el.attrs) : 'undefined' \n    })${children? `,${children}`:'' \n  }`\n\n  return code\n}","// 标签名\nvar ncname = \"[a-zA-Z_][\\\\-\\\\.0-9_a-zA-Z]*\";\n// 获取标签名 match后的索引为1的\nvar qnameCapture = \"((?:\" + ncname + \"\\\\:)?\" + ncname + \")\";\n// 匹配开始标签\nvar startTagOpen = new RegExp((\"^<\" + qnameCapture));\n// 匹配标签的关闭 <div/>\nvar startTagClose = /^\\s*(\\/?)>/;\n// 匹配闭合标签\nvar endTag = new RegExp((\"^<\\\\/\" + qnameCapture + \"[^>]*>\"));\n// 匹配属性 aa = \"xxx\" | 'xxx' | xxx  a=b a=\"b\" a ='b'\nvar attribute = /^\\s*([^\\s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/;\n// 匹配大括号 {{}}\nvar defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g;// {{aaaa}}\n\n//将解析后的结果 组装成一个树结构 ast树 栈\n\nfunction createAstElement(tagName, attrs) {\n  return {\n    tag: tagName,\n    type: 1,\n    children: [],\n    parent: null,\n    attrs\n  }\n} \n\nlet root = null\nlet stack = []\nfunction start (tagName, attributes) {\n  let parent = stack[stack.length - 1]\n  let element = createAstElement(tagName, attributes)\n  if (!root) {\n    root = element\n  }\n  \n  if (parent) {\n    element.parent = parent //当放入栈中时,记录父亲是谁\n    element.children.push(element)\n  }\n  stack.push(element)\n}\n\nfunction end (tagName) {\n  let last = stack.pop()\n  if (last.tag !== tagName) {\n    throw new Error('标签有误')\n  }\n}\n\nfunction chars(text) {\n  text = text.replace(/\\s/g, \"\")\n  let parent = stack[stack.length - 1]\n  if (text) {\n    parent.children.push({\n      type: 3,\n      text\n    })\n  }\n\n}\n\n// ast (语法层面的描述 js css html) vdom （dom节点）\n// html字符串解析成dom树 解析成对应的脚本  <div id = 'app'> {{name}} </div>\n\nexport function parserHTML(html) { // <div id=\"app\">111</div>\n  \n\n  function advance(len){\n    html = html.substring(len)\n  }\n\n  function parseStartTag() {\n    const start = html.match(startTagOpen)\n    if(start){\n      const match = {\n        tagName: start[1],\n        attrs: []\n      }\n      // 去掉匹配到的开始标签\n      advance(start[0].length)\n      let end\n      // 如果没有遇到标签结尾就不停的解析\n      let attr\n      while (!(end  = html.match(startTagClose)) && (attr = html.match(attribute))) {\n        match.attrs.push({name: attr[1], value: attr[3] || attr[4] || attr[5]})\n        advance(attr[0].length)\n      } \n      if (end) {\n        advance(end[0].length)\n      } \n      return match\n    }\n    return false // 不是开始标签\n  }\n\n  while (html) { // 看解析的内容是否存在，如果存在就不停的解析\n    let textEnd = html.indexOf('<') // 当前解析的开头\n    if (textEnd == 0) {\n\n      const startTagMatch = parseStartTag() // 解析开始标签\n      if (startTagMatch) {\n        start(startTagMatch.tagName, startTagMatch.attrs)\n        continue\n      }\n\n      const endTagMatch = html.match(endTag)\n      if(endTagMatch) {\n        end(endTagMatch[1])\n        advance(endTagMatch[0].length)\n        continue\n      }\n    }\n    let text // 123123</div>\n    if(textEnd > 0) {\n      text = html.substring(0, textEnd)\n    }\n    if(text) {\n      chars(text)\n      advance(text.length)\n    }\n  }\n  return root\n}\n\n// 看一下用户是否传入了render，没传入可能传入的事template，template如果也没传就解析\n// html => 词法解析（开始标签 ，结束标签， 属性， 文本） => ast语法树 用来描述html语法的 stack = []\n// codegen函数将<div>hello</div> => _c('div', {}, 'hello') => 让字符串执行\n// 字符串转为代码  eval 耗性能 会有作用域问题\n\n// 模版引擎 通过new Function + with 来实现","import { generate } from \"./generate\";\nimport { parserHTML } from \"./parser\";\n\n\nexport function compileToFunction(template) {\n  \n  let root = parserHTML(template)\n  //生成代码\n  let code = generate(root)\n  console.log(code, 'code')\n  let render = new Function(`with(this){return ${code}}`) //code中会用到数据,数据在vm上\n\n  return render\n\n  // render(){\n  //   return _c('div', {id: 'app'}, 'hello')\n  // }\n   \n  // 虚拟dom\n  // {tag: div, data:{id: 'app', a:1},children: [{text:'hello'}]}\n\n  // html => ast（只能描述语法 语法不存在的属性无法描述） => render函数 (with + new Function) => 虚拟dom (增加额外的属性) => 生成真实dom\n\n  \n}\n\n// with用法\n// let vm = {arr: 1}\n// with(vm) {\n//   console.log(arr) // 1\n// }","\nexport function patch(oldVnode, vnode) {\n  if(oldVnode.nodeType === 1) {\n    console.log(oldVnode, 'oldVnode')\n    //用vnode生成真实dom，替换原本的dom元素\n    const parentElm = oldVnode.parentNode //找到它的父亲\n    let elm = createElm(vnode) // 根据虚拟节点 创建元素\n    parentElm.insertBefore(elm, oldVnode.nextSibling)\n    parentElm.removeChild(oldVnode)\n  }\n}\n\nfunction createElm(vnode) {\n  let {tag, data, children, text, vm} = vnode\n  if(typeof tag === 'string') { // 元素\n    vnode.el = document.createElement(tag) //虚拟节点会有一个el属性,对应真实节点\n    children.forEach(child => {\n      vnode.el.appendChild(createElm(child))\n    })\n  } else {\n    vnode.el = document.createTextNode(text)\n  }\n  return vnode.el\n}","import { patch } from \"./vdom/patch\"\n\n\nexport function lifecycleMixin(Vue) {\n  Vue.prototype._update = function(vnode) {\n    // 既有初始化,又有更新\n    const vm = this\n    patch( vm.$el, vnode)\n\n  }\n}\n\nexport function mountComponent(vm, el) {\n\n  // 更新函数 数据变化后 会再次调用此函数\n  let updateComponent = () => {\n    //调用render函数,生成虚拟dom\n    vm._update(vm._render()) // 后续更新可以调用updateComponent方法\n    // 用虚拟dom,生成真实dom\n  }\n  updateComponent()\n\n}","export function isFunction (val) {\n  return typeof val === 'function'\n}\n\nexport function isObject(val) {\n  return typeof val === 'object' && val !== null\n}","let oldArrayPrototype = Array.prototype\n// 继承数组方法\nexport let arrayMethods = Object.create(oldArrayPrototype)\n// arrayMethods.__proto__ = Array.prototype \n\n//只有这7个可以改变原数组\nlet methods = [\n  'push',\n  'shift',\n  'unshift',\n  'pop',\n  'reverse',\n  'sort',\n  'splice'\n]\n\nmethods.forEach(method => {\n  // 用户调用的如果是以上七个方法,会用重写的,负责调用原来的数组方法\n  arrayMethods[method] = function (...args) {\n    // 此处this是数组\n    oldArrayPrototypep[method].call(this, ...args)\n    let inserted\n    let ob = this.__ob__//根据当前数组获取observe实例\n    switch(method){\n      case 'push':\n      case 'unshift':\n        inserted = args // 就是新增的内容\n        break\n      case 'splice':\n        inserted = args.slice(2)\n        break\n      default: \n        break\n    }\n    // 如果有新增的内容要继续劫持 需要观测数组每一项,而不是数组\n    if(inserted) ob.observeArray(inserted)\n\n    // arr.push({a:1}, {b:2})\n    // arr.splice(0, 1, xxxx)\n  }\n})","import { isObject } from \"../util\";\nimport { arrayMethods } from \"./array\";\n\n// 1.如果数据是对象 会将对象不停的递归 进行劫持\n// 2.如果是数组, 会劫持数组的方法 并对数组中不是基本数据类型的进行检测\n\n//检测数据变化，类有类型,对象无类型\nclass Observer{\n  constructor(data) {//对对象中的所有属性进行劫持\n    Object.defineProperty(data, '__ob__', {\n      value: this,\n      enumerable: false //不可枚举\n    })\n    // data.__ob__ = this //所有被劫持过的属性都有__ob__\n    if(Array.isArray(data)) {\n      //数组劫持，对数组原来方法改写,切片编程\n      data.__proto__  = arrayMethods\n      //如果数组中的数据是对象类型,需要监控对象的变化\n      this.observeArray(data)\n    }else {\n      this.walk(data) //对象劫持\n    }\n  }\n\n  observeArray(data) { //对数组中的数组和数组中的对象再次劫持\n    data.forEach(item => {\n      observe(item)\n    })\n  }\n\n  walk(data) {//传入的对象\n    Object.keys(data).forEach(key => {\n      defineReactive(data, key, data[key])\n    })\n  }\n}\n\n//vue2会对对象进行遍历,将每个属性用defineProperty重新定义,所以导致性能差\nfunction defineReactive(data, key, value){//value有可能是对象\n  observe (value)//本身用户默认值是对象套对象,需要递归处理（性能差）\n  Object.defineProperty(data, key,{\n    get() {\n      return value\n    },\n    set(newV) {\n      observe (newV)// 如果用户赋值一个新对象,需要将这个对象进行劫持\n      value = newV\n    }\n  })\n}\n\nexport function observe (data) {\n  //如果是对象类型才观测\n  if(!isObject(data)) {\n    return\n  }\n  //判断data有没有被观测\n  if(data.__ob__) {\n    return\n  }\n  return new Observer(data)\n}","import { observe } from \"./observer/index\"\nimport { isFunction } from \"./util\"\n\n// 状态初始化\nexport function initState(vm) {\n  const opts = vm.$options\n  // if (opts.props) {\n  //   initProps()\n  // }\n  if (opts.data) {\n    initData(vm)\n  }\n  // if (opts.computed) {\n  //   initComputed()\n  // }\n  // if (opts.watch) {\n  //   initWatch()\n  // }\n}\n\n// 代理\nfunction proxy(vm, source, key) {\n  Object.defineProperty(vm, key, {\n    get() {\n      return vm[source][key]\n    },\n    set(newVal) {\n      vm[source][key] = newVal\n    }\n  })\n}\n\nfunction initData(vm) {\n  let data = vm.$options.data // vm.$el vue内部会对属性检测如果以$开头 不会进行代理\n  // vue2会将data中的所有数据进行劫持 Object.defineProperty\n  //这个时候data和vm没有任何关系,通过_data进行关联\n  data = vm._data =isFunction(data)?data.call(vm): data\n\n  for(let key in data) { //取name时直接可以写vm.name vm.xxx => vm._data.xxx\n    proxy(vm, '_data', key)\n  }\n  \n  observe(data)\n}","import { compileToFunction } from \"./compiler/index\"\nimport { mountComponent } from \"./lifecycle\"\nimport { initState } from \"./state\"\n\nexport function initMixin(Vue) { //表示在vue的基础上做一次混合操作\n  Vue.prototype._init = function (options) {\n    const vm = this\n    vm.$options = options//后面会对options进行扩展\n\n    // 对数据进行初始化\n    initState(vm)//vm.$options.data 数据劫持\n\n    \n    if(vm.$options.el) {\n      // 将数据挂载到这个模板上\n      vm.$mount(vm.$options.el)\n    }\n  }\n\n  Vue.prototype.$mount = function (el) {\n    const vm = this\n    const options = vm.$options\n    el = document.querySelector(el)\n    vm.$el = el\n    console.log(el ,'el')\n\n    // 把模版转换成 对应的渲染函数 =》 虚拟dom vnode diff算法 更新虚拟dom => 真实dom\n\n    if(!options.render) { // 没有render用template\n      let template = options.template\n      if(!template && el) {// 没有template就取el的内容作为模板\n        template = el.outerHTML\n        let render = compileToFunction(template)\n        options.render = render\n      }\n    }\n    // options.render就是渲染函数\n    // 调用render方法 渲染成真实dom 替换掉页面的内容\n\n    mountComponent(vm, el) // 组件挂载过程\n  }\n\n}\n\n","export function createElement(vm, tag, data={}, ...children) {\n  return vnode(vm, tag, data, data.key, children, undefined)\n}\n\nexport function createTextElement(vm, text) {\n  return vnode(vm, undefined, undefined, undefined, undefined, text)\n}\n\nfunction vnode(vm, tag, data, key, children, text){\n\n  return {\n    vm,\n    tag,\n    data,\n    key,\n    children,\n    text\n  }\n\n}","import { createElement, createTextElement } from \"./vdom/index\"\n\nexport function renderMixin(Vue) {\n  Vue.prototype._c = function() {//createElement\n    return createElement(this,...arguments)\n  }\n  Vue.prototype._v = function(text) { //createTextElement\n    return createTextElement(this,text)\n  }\n  Vue.prototype._s = function(val) {// stringify\n    if(typeof val === 'object') return JSON.stringify(val)\n    return val\n  }\n\n  Vue.prototype._render = function() {\n    const vm = this\n    let render = vm.$options.render // 解析出来的render方法,同时也可能是用户写的\n\n    let vnode = render.call(vm)\n\n      console.log(vnode, 'vnode')\n\n    return vnode\n  }\n}","//用class类写vue不好拆封,所以采用构造函数方式写\n\nimport { initMixin } from './init'\nimport { lifecycleMixin } from './lifecycle'\nimport { renderMixin } from './render'\n\nfunction Vue(options) {\n  // options用户传入选项\n  //构造函数中的this指向new的实例\n  this._init(options)// 初始化操作\n}\n// 扩展原型\ninitMixin(Vue)\nrenderMixin(Vue) // _render\nlifecycleMixin(Vue) // _update\n\nexport default Vue"],"names":["defaultTagRE","genProps","attrs","str","i","length","attr","name","styleObj","value","replace","arguments","JSON","stringify","slice","gen","el","type","generate","text","test","tokens","match","lastIndex","exec","index","push","trim","join","genChildren","children","map","c","code","tag","ncname","qnameCapture","startTagOpen","RegExp","startTagClose","endTag","attribute","createAstElement","tagName","parent","root","stack","start","attributes","element","end","last","pop","Error","chars","parserHTML","html","advance","len","substring","parseStartTag","textEnd","indexOf","startTagMatch","endTagMatch","compileToFunction","template","console","log","render","Function","patch","oldVnode","vnode","nodeType","parentElm","parentNode","elm","createElm","insertBefore","nextSibling","removeChild","data","vm","document","createElement","forEach","child","appendChild","createTextNode","lifecycleMixin","Vue","prototype","_update","$el","mountComponent","updateComponent","_render","isFunction","val","isObject","oldArrayPrototype","Array","arrayMethods","Object","create","methods","method","args","oldArrayPrototypep","call","inserted","ob","__ob__","observeArray","Observer","defineProperty","enumerable","isArray","__proto__","walk","item","observe","keys","key","defineReactive","get","set","newV","initState","opts","$options","initData","proxy","source","newVal","_data","initMixin","_init","options","$mount","querySelector","outerHTML","undefined","createTextElement","renderMixin","_c","_v","_s"],"mappings":"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"}